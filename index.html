<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת סידור עבודה עם Google Sheets והשוואת חילנט</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="CSS/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF.js - גרסה מעודכנת -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // הגדרת נתיב ה-worker עבור PDF.js כדי למנוע אזהרות
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
   
</head>
<body class="bg-slate-100 p-4 sm:p-6 md:p-8">

    <div class="max-w-6xl mx-auto">
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">מערכת סידור משמרות</h1>
            <p class="text-slate-600 mt-2 text-lg">הנתונים נשמרים ונקראים ישירות מ-Google Sheets.</p>
        </div>

        <div class="card flex flex-col md:flex-row justify-between items-center gap-4">
            <div id="auth-section" class="flex items-center gap-3">
                <button id="authorize_button" class="btn btn-blue" disabled>התחבר/אשר עם Google</button>
                <button id="signout_button" class="btn btn-red hidden">התנתק</button>
            </div>
            <div id="status-indicator" class="flex items-center gap-2 text-sm text-slate-500 p-2 rounded-md"></div>
        </div>

        <div id="app-content" class="hidden">
            <div class="card flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3">
                    <label for="date-picker" class="font-semibold text-slate-700">בחר שבוע:</label>
                    <input type="date" id="date-picker" class="p-2 border border-slate-300 rounded-md">
                </div>
                <div class="flex items-center gap-3 flex-wrap justify-center">
                    <button id="reset-btn" class="btn btn-red text-sm py-2 px-4">אפס שבוע</button>
                    <button id="send-email-btn" class="btn btn-blue">שלח במייל</button>
                    <button id="download-excel-btn" class="btn btn-green">ייצוא ל-Excel</button>
                    <button id="copy-previous-week-btn" class="btn btn-blue">העתק שבוע קודם</button>
                    <button id="create-calendar-events-btn" class="btn btn-blue">צור אירועי יומן 📅</button>
                    <button id="delete-calendar-events-btn" class="btn btn-red">מחק אירועי יומן לשבוע זה 🗑️</button>
                    <button id="refresh-data-btn" class="btn btn-slate">רענן נתונים 🔄</button>
                    <button id="vacation-shift-btn" class="btn btn-blue">חופש מאור/מור 🏖️</button>
                    <a href="https://assuta.net.hilan.co.il/login" target="_blank" class="btn btn-orange">פתח אתר חילנט</a>
                    <input type="file" id="upload-hilanet-input" accept=".pdf, .xlsx, .xls" class="hidden">
                    <button id="upload-hilanet-btn" class="btn btn-purple">העלה קובץ מחילנט (PDF/XLSX)</button>
                    <button id="show-chart-btn" class="btn btn-green">הצג גרף משמרות 📊</button>
                </div>
            </div>

            <div id="schedule-card" class="card">
                <h2 id="schedule-title" class="text-2xl font-semibold mb-4 text-slate-700 text-center"></h2>
                <div class="overflow-x-auto">
                    <table id="schedule-table" class="w-full text-center text-slate-700 border-collapse">
                        <thead class="bg-slate-200">
                            <tr>
                                <th class="p-3 border border-slate-300">יום</th>
                                <th class="p-3 border border-slate-300">תאריך</th>
                                <th class="p-3 border border-slate-300">משמרת בוקר</th>
                                <th class="p-3 border border-slate-300">משמרת ערב</th>
                            </tr>
                        </thead>
                        <tbody id="schedule-body" class="bg-white"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="chart-container-wrapper">
                <div id="chart-card" class="card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700 text-center">גרף התפלגות משמרות שבועית</h2>
                    <div class="chart-container">
                        <canvas id="shift-chart"></canvas>
                    </div>
                </div>

                <div id="monthly-summary-chart-card" class="card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700 text-center">סיכום משמרות חודשי לעובד</h2>
                    <div class="mb-4">
                        <label for="monthly-summary-employee-select" class="block text-sm font-medium text-slate-700 mb-2">בחר עובד:</label>
                        <select id="monthly-summary-employee-select" class="p-2 border border-slate-300 rounded-md w-full max-w-xs">
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="monthly-summary-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="shift-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 id="modal-title" class="text-xl font-bold mb-6 text-center text-slate-800"></h3>
            <div id="modal-options" class="space-y-3"></div>
            <button id="gemini-suggestion-btn" class="mt-4 w-full p-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold">הצע לי שיבוץ לעובד</button>
            <div class="space-y-4 mt-4">
                <div>
                    <label for="shift-start-time" class="block text-sm font-medium text-slate-700">שעת התחלה:</label>
                    <input type="time" id="shift-start-time" class="mt-1 block w-full p-2 border border-slate-300 rounded-md">
                </div>
                <div>
                    <label for="shift-end-time" class="block text-sm font-medium text-slate-700">שעת סיום:</label>

                    <input type="time" id="shift-end-time" class="mt-1 block w-full p-2 border border-slate-300 rounded-md">
                </div>
            </div>
            <button id="modal-save-btn" class="mt-6 w-full p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold">שמור</button>
            <button id="modal-close-btn" class="mt-2 w-full p-3 bg-slate-200 hover:bg-slate-300 rounded-lg font-semibold">ביטול</button>
        </div>
    </div>

    <div id="employee-selection-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 id="employee-selection-modal-title" class="text-xl font-bold mb-6 text-center text-slate-800">בחר עובדים</h3>
            <div id="employee-checkboxes-container" class="space-y-3 mb-6"></div>
            <div class="flex justify-center gap-4">
                <button id="employee-selection-confirm-btn" class="btn btn-blue px-6 py-2">אישור</button>
                <button id="employee-selection-cancel-btn" class="btn bg-slate-200 text-slate-700 hover:bg-slate-300 px-6 py-2">ביטול</button>
            </div>
        </div>
    </div>

    <div id="vacation-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-6 text-center text-slate-800">הגדר חופשה לעובד</h3>
            <div class="space-y-4">
                <div>
                    <label for="vacation-employee-select" class="block text-sm font-medium text-slate-700">בחר עובד:</label>
                    <select id="vacation-employee-select" class="mt-1 block w-full p-2 border border-slate-300 rounded-md">
                        <option value="">בחר עובד</option>
                        <option value="מאור">מאור</option>
                        <option value="מור">מור</option>
                        </select>
                </div>
                <div>
                    <label for="vacation-start-date" class="block text-sm font-medium text-slate-700">תאריך התחלה:</label>
                    <input type="date" id="vacation-start-date" class="mt-1 block w-full p-2 border border-slate-300 rounded-md">
                </div>
                <div>
                    <label for="vacation-end-date" class="block text-sm font-medium text-slate-700">תאריך סיום:</label>
                    <input type="date" id="vacation-end-date" class="mt-1 block w-full p-2 border border-slate-300 rounded-md">
                </div>
            </div>
            <div class="flex justify-center gap-4 mt-8">
                <button id="vacation-confirm-btn" class="btn btn-blue px-6 py-2">שבץ חופשה</button>
                <button id="vacation-cancel-btn" class="btn bg-slate-200 text-slate-700 hover:bg-slate-300 px-6 py-2">ביטול</button>
            </div>
        </div>
    </div>

    <div id="differences-modal" class="hidden custom-modal">
    <div id="differences-modal-content" class="custom-modal-content differences-modal-content">
        <h3 class="text-xl font-bold mb-4 text-slate-800">פערים בסידור עבודה (מאור)</h3>
        <div id="differences-display" class="text-sm text-slate-700 mb-4 overflow-x-auto"></div>
        <div class="flex justify-center gap-4">
            <button id="import-selected-hilanet-shifts-btn" class="btn btn-purple">יבוא משמרות נבחרות למערכת שלי</button>
            <button id="download-differences-btn" class="btn btn-green">הורד מסמך הבדלים (CSV)</button>
            <button id="close-differences-modal-btn" class="btn bg-slate-200 text-slate-700 hover:bg-slate-300">סגור</button>
        </div>
    </div>
</div>

    <script type="module" src="JS/main.js"></script>
</body>
</html>